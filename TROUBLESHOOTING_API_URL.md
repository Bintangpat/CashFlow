# üîß Troubleshooting: API URL Configuration Error

## Problem
Getting error in Vercel console:
```
POST https://your-app.vercel.app/your-railway-url.up.railway.app/api/... 405 (Method Not Allowed)
```

## Root Cause
`NEXT_PUBLIC_API_URL` in Vercel is missing the `https://` protocol, causing it to be treated as a relative URL instead of an absolute URL.

## Solution

### 1. Go to Vercel Dashboard
1. Open your project
2. Go to **Settings** ‚Üí **Environment Variables**
3. Find `NEXT_PUBLIC_API_URL`

### 2. Correct Format
Your Railway URL is: `cashflow-production-b118.up.railway.app`

**‚ùå WRONG (missing protocol):**
```
NEXT_PUBLIC_API_URL=cashflow-production-b118.up.railway.app/api
```

**‚úÖ CORRECT (with https://):**
```
NEXT_PUBLIC_API_URL=https://cashflow-production-b118.up.railway.app/api
```

### 3. Update the Variable
1. Click **Edit** on `NEXT_PUBLIC_API_URL`
2. Change value to: `https://cashflow-production-b118.up.railway.app/api`
3. Click **Save**

### 4. Redeploy
1. Go to **Deployments** tab
2. Click **...** on latest deployment
3. Click **Redeploy**

### 5. Verify
After redeployment:
1. Open your Vercel app
2. Open DevTools ‚Üí Console
3. Try to login
4. Should now see:
   ```
   POST https://cashflow-production-b118.up.railway.app/api/auth/login 200 (OK)
   ```

## Why This Happens
When a URL doesn't start with `http://` or `https://`, the browser treats it as a relative path and appends it to the current domain.

**Example**:
- Current page: `https://my-app.vercel.app`
- API URL set as: `my-api.railway.app/api` (no protocol)
- Result: `https://my-app.vercel.app/my-api.railway.app/api` ‚ùå

**Correct**:
- Current page: `https://my-app.vercel.app`
- API URL set as: `https://my-api.railway.app/api` (with protocol)
- Result: `https://my-api.railway.app/api` ‚úÖ

## Prevention
Added validation in `api.ts` that will show a clear error in console if URL is misconfigured:
```
‚ùå NEXT_PUBLIC_API_URL must start with http:// or https://
Current value: cashflow-production-b118.up.railway.app/api
Expected format: https://your-api-domain.com/api
```

## Quick Reference: All Environment Variables

### Railway (Backend)
```env
NODE_ENV=production
DATABASE_URL=<auto-generated-by-railway>
JWT_SECRET=<generate-32-char-secret>
JWT_EXPIRES_IN=7d
RESEND_API_KEY=<your-resend-key>
EMAIL_FROM=CashFlow <noreply@yourdomain.com>
FRONTEND_URL=https://cash-flow-two-iota.vercel.app
```

### Vercel (Frontend)
```env
NEXT_PUBLIC_API_URL=https://cashflow-production-b118.up.railway.app/api
NEXTAUTH_URL=https://cash-flow-two-iota.vercel.app
NEXTAUTH_SECRET=<generate-32-char-secret>
```

## Still Having Issues?

### Check CORS
Make sure `FRONTEND_URL` in Railway matches your Vercel URL:
```env
FRONTEND_URL=https://cash-flow-two-iota.vercel.app
```
(No trailing slash!)

### Check Railway is Running
Visit: `https://cashflow-production-b118.up.railway.app/`

Should show:
```json
{
  "status": "OK",
  "message": "CashFlow API is running"
}
```

### Check Network Tab
1. Open DevTools ‚Üí Network tab
2. Try login again
3. Click on the failed request
4. Check **Request URL** - should start with `https://cashflow-production-b118.up.railway.app`
